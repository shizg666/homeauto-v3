<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.landleaf.homeauto.center.device.model.mapper.ProductAttributeErrorMapper">

    <resultMap id="productAttributeErrorVO" type="com.landleaf.homeauto.common.domain.vo.category.ProductAttributeErrorVO">
        <result column="id" property="id"/>
        <result column="type" property="type"/>
        <result column="code" property="code"/>
        <result column="max" property="max"/>
        <result column="min" property="min"/>
        <result column="code_name" property="codeName"/>
        <collection property="infos" ofType="com.landleaf.homeauto.common.domain.vo.category.ProductAttributeErrorInfoDTO">
            <result column="sort_no" property="sortNo"/>
            <result column="val" property="val"/>
        </collection>
    </resultMap>


    <select id="getErrorAttributeInfo"
            resultType="com.landleaf.homeauto.common.domain.vo.category.AttributeErrorDTO">
        SELECT
            pe.ID,
            pe.TYPE,
            pe.MAX,
            pe.MIN,
            pe.code
        FROM
            product_attribute_error pe
        WHERE
            pe.product_code = #{productCode}
            AND pe.code = #{code}
        limit 1
    </select>
    <select id="getListAttributesErrorsDeatil"
            resultMap="productAttributeErrorVO">
           SELECT
                pe.ID,
                pe.TYPE,
                pe.MAX,
                pe.MIN,
                pe.code,
                pe.code_name,
                pai.sort_no,
                pai.val
            FROM
                product_attribute_error pe
				left join product_attribute_error_info pai on   pe.ID = pai.error_attribute_id

            WHERE
                pe.product_id = #{productId}
                ORDER BY pe.create_time desc, pai.sort_no asc
    </select>

    <select id="existErrorAttrCode" resultType="java.lang.Integer">
      	select count(1) from product_attribute_error pe where pe.code = #{code} and pe.product_id = #{productId} limit 1
    </select>
    <select id="getAttributePrecision"
            resultType="com.landleaf.homeauto.common.domain.vo.category.AttributePrecisionDTO">
        SELECT
            pa.code,
            pas.PRECISION
        FROM
            product_attribute pa
            INNER JOIN product_attribute_info_scope pas ON pas.parent_id = pa.ID
            AND pas.TYPE = 1
        WHERE
            pa.product_code = #{productCode}
            <if test="code !=null and code != '' ">
                and pa.code =  #{code}
            </if>

    </select>
    <select id="getListCacheInfo"
            resultType="com.landleaf.homeauto.common.domain.vo.category.AttributeErrorDTO">
        SELECT
            e.id,
            e.code,
            e.type,
            e.max,
            e.min,
            e.product_code
        FROM
            product_attribute_error e
    </select>

</mapper>
